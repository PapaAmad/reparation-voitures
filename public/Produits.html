<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Général automobile</title>
    <style>
        body { 
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #ffffff;
            color: #333; 
        }
        .container {
            width: 80%;
            margin: auto;
            overflow: hidden;
            padding: 20px;
        }
        header { 
            background: #35424a;
            color: #ffffff;
            padding-top: 30px;
            min-height: 70px;
            border-bottom: #e8491d 3px solid;
        }
        header a {
            color: #ffffff;
            text-decoration: none;
            text-transform: uppercase;
            font-size: 16px;
        }
        header ul {
            padding: 0;
            margin: 0;
            list-style: none;
            overflow: hidden;
        }
        header li {
            float: left;
            display: inline;
            padding: 0 20px 0 20px;
        }
        header #branding {
            float: left;
        }
        header #branding h1 {
            margin: 0;
        }
        header nav {
            float: right;
            margin-top: 10px;
        }
        header .highlight, header .current a {
            color: #e8491d;
            font-weight: bold;
        }
        header a:hover {
            color: #ffffff;
            font-weight: bold;
        }
        #main {
            padding: 30px 0;
            background: #ffffff;
        }

        nav a { 
            color: white; 
            text-decoration: none; 
            margin-left: 20px; 
        }
        .content { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        .product { 
            background-color: white; 
            border: 1px solid #ddd; 
            padding: 20px; 
            margin-bottom: 20px; 
            display: flex; 
        }
        .product-image { 
            width: 200px; 
            height: 200px; 
            object-fit: cover; 
            margin-right: 20px; 
        }
        .product-details { 
            flex: 1; 
        }
        .product h2 { 
            color: #e74c3c; 
            margin-top: 0; 
        }
        .product p { 
            color: #333; 
        }
        .product .price { 
            font-weight: bold; 
            color: #27ae60; 
        }
        .button { 
            display: inline-flex; 
            align-items: center; 
            background-color: #3498db; 
            color: white; 
            padding: 10px 20px; 
            text-decoration: none; 
            border-radius: 5px; 
            cursor: pointer; 
        }
        .button svg { 
            margin-right: 10px; 
        }
        #cart-page {
            display: none;
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        #cart-items {
            margin-bottom: 20px;
        }

        .cart-item {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-item-details {
            flex-grow: 1;
        }

        .cart-item-quantity {
            display: flex;
            align-items: center;
            margin-right: 10px;
        }

        .quantity-btn {
            background-color: #f1f1f1;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            font-size: 18px;
            cursor: pointer;
            margin: 0 5px;
        }

        .remove-from-cart {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }

        #cart-total {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        #checkout-button {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
        }

        #cart-count {
            background-color: #e74c3c;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 12px;
            margin-left: 5px;
        }
        #order-form {
            background: #ffffff;
            padding: 20px;
            border: 1px solid #dddddd;
            margin-top: 20px;
            width: 50%;
            margin: 20px auto;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        #order-form h2 {
            margin-top: 0;
            font-size: 24px;
            color: #333333;
        }

        #orderDetailsForm div {
            margin-bottom: 15px;
        }

        #orderDetailsForm label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333333;
        }

        #orderDetailsForm input {
            width: 100%;
            padding: 8px;
            border: 1px solid #dddddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
        }

        #orderDetailsForm button {
            background: #35424a;
            color: #ffffff;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        #orderDetailsForm button:hover {
            background: #e8491d;
        }

        @media (max-width: 768px) {
            #order-form {
                width: 90%;
                padding: 15px;
            }

            #orderDetailsForm input {
                font-size: 14px;
            }

            #orderDetailsForm button {
                font-size: 14px;
                padding: 8px 12px;
            }
        }

    </style>
</head>
<body>
    <header>
        <div class="container">
            <div id="branding">
                <h1><span class="highlight">Général</span> Automobile</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html">Accueil</a></li>
                    <li><a href="Services.html">Services</a></li>
                    <li><a href="Contacts.html">Contact</a></li>
                    <li class="current"><a href="Produits.html">Produits</a></li>
                    <li><a href="#" id="cart-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="9" cy="21" r="1"></circle>
                            <circle cx="20" cy="21" r="1"></circle>
                            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                        </svg>
                        <span id="cart-count">0</span>
                    </a></li>
                </ul>
            </nav>
        </div>
    </header>
    <div class="content">
        <div id="products-page">
            <h2>Nos Produits</h2>
            <div id="product-list"></div>
        </div>
        <div id="cart-page" style="display:none;">
            <h2>Votre Panier</h2>
            <div id="cart-items"></div>
            <p>Total: <span id="cart-total">0</span> Francs CFA</p>
            <button id="checkout-button">Commander</button>
        </div>
    </div>

    <div id="order-form" style="display:none;">
        <h2>Passer la commande</h2>
        <form id="orderDetailsForm">
            <div>
                <label for="prenom">Prénom:</label>
                <input type="text" id="prenom" name="prenom" required>
            </div>
            <div>
                <label for="nom">Nom:</label>
                <input type="text" id="nom" name="nom" required>
            </div>
            <div>
                <label for="telephone">Numéro de téléphone:</label>
                <input type="tel" id="telephone" name="telephone" required>
            </div>
            <button type="submit">Envoyer la commande</button>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            const cartItems = [];
            let cartTotal = 0;

            const updateCartDisplay = () => {
                const cartItemsDiv = document.getElementById('cart-items');
                const cartTotalSpan = document.getElementById('cart-total');
                const cartCountSpan = document.getElementById('cart-count');

                cartItemsDiv.innerHTML = '';
                cartTotal = 0;

                cartItems.forEach((item, index) => {
                    const itemTotal = item.price * item.quantity;
                    cartTotal += itemTotal;

                    const itemElement = document.createElement('div');
                    itemElement.className = 'cart-item';
                    itemElement.innerHTML = `
                        <span>${item.name} - ${item.price} Francs CFA x ${item.quantity}</span>
                        <button class="increase-quantity" data-index="${index}">+</button>
                        <button class="decrease-quantity" data-index="${index}">-</button>
                        <button class="remove-from-cart" data-index="${index}">Supprimer</button>
                    `;
                    cartItemsDiv.appendChild(itemElement);
                });

                cartTotalSpan.textContent = cartTotal;
                cartCountSpan.textContent = cartItems.reduce((sum, item) => sum + item.quantity, 0);
            };

            const response = await fetch('/api/products');
            const products = await response.json();
            const productList = document.getElementById('product-list');

            products.forEach(product => {
                const productElement = document.createElement('div');
                productElement.className = 'product';
                productElement.innerHTML = `
                    <img src="/uploads/${product.image}" alt="${product.nom}" class="product-image">
                    <div class="product-details">
                        <h2>${product.nom}</h2>
                        <p>${product.description}</p>
                        <p class="price">Prix: ${product.prix} Francs CFA</p>
                        <a href="#" class="button add-to-cart" data-id="${product._id}" data-name="${product.nom}" data-price="${product.prix}">
                            Ajouter au panier
                        </a>
                    </div>
                `;
                productList.appendChild(productElement);
            });

            document.getElementById('product-list').addEventListener('click', function(e) {
                if (e.target.classList.contains('add-to-cart')) {
                    e.preventDefault();
                    const id = e.target.getAttribute('data-id');
                    const name = e.target.getAttribute('data-name');
                    const price = parseFloat(e.target.getAttribute('data-price'));

                    const existingItem = cartItems.find(item => item.id === id);
                    if (existingItem) {
                        existingItem.quantity += 1;
                    } else {
                        cartItems.push({ id, name, price, quantity: 1 });
                    }

                    updateCartDisplay();
                }
            });

            document.getElementById('cart-items').addEventListener('click', function(e) {
                const index = parseInt(e.target.getAttribute('data-index'));
                if (e.target.classList.contains('remove-from-cart')) {
                    cartItems.splice(index, 1);
                } else if (e.target.classList.contains('increase-quantity')) {
                    cartItems[index].quantity += 1;
                } else if (e.target.classList.contains('decrease-quantity')) {
                    if (cartItems[index].quantity > 1) {
                        cartItems[index].quantity -= 1;
                    } else {
                        cartItems.splice(index, 1);
                    }
                }
                updateCartDisplay();
            });

            document.getElementById('cart-icon').addEventListener('click', function(e) {
                e.preventDefault();
                const productsPage = document.getElementById('products-page');
                const cartPage = document.getElementById('cart-page');
                
                if (cartPage.style.display === 'none') {
                    productsPage.style.display = 'none';
                    cartPage.style.display = 'block';
                } else {
                    productsPage.style.display = 'block';
                    cartPage.style.display = 'none';
                }
            });

            document.getElementById('checkout-button').addEventListener('click', function() {
                document.getElementById('order-form').style.display = 'block';
            });

            document.getElementById('orderDetailsForm').addEventListener('submit', async function(e) {
                e.preventDefault();

                const prenom = document.getElementById('prenom').value;
                const nom = document.getElementById('nom').value;
                const telephone = document.getElementById('telephone').value;

                const orderDetails = {
                    prenom,
                    nom,
                    telephone,
                    cartItems,
                    total: cartTotal
                };

                try {
                    const response = await fetch('/api/order', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(orderDetails)
                    });

                    if (response.ok) {
                        alert('Le gérant va vous appeler d\'ici peu.');
                        // Vider le panier après une commande réussie
                        cartItems.length = 0;
                        updateCartDisplay();
                        document.getElementById('order-form').style.display = 'none';
                    } else {
                        alert('Erreur lors de l\'envoi de la commande.');
                    }
                } catch (error) {
                    console.error('Erreur:', error);
                }
            });

            updateCartDisplay();
        });
    </script>
</body>
</html>